<app-nav-bar class="mb-4"></app-nav-bar>
<div class="container" style="margin-top: 20px;">
  <ng-container *ngIf="!addGastosView">
    <button class="btn btn-primary" (click)="toggleAddGastosView()">Adicionar Gasto Manual</button>
    <button class="btn btn-primary" (click)="toggleAddGastosView()">Adicionar Gastos em Lote</button>
  </ng-container>
  <ng-container *ngIf="addGastosView">
    <button class="btn btn-primary" (click)="toggleAddGastosView() ">Voltar</button>
  </ng-container>
</div>

<div *ngIf="!addGastosView" style="margin-top: 30px;">
  <div class="container">
    <h3>Tela de Gastos Comuns</h3>
    <form [formGroup]="myForm"> <!-- Wrap your form controls within a formGroup directive -->
      <div class="row">
        <div class="col-md-4">
          <select id="building_id" name="building_id" class="form-control custom-select" formControlName="building_id" required (change)="loadExpenses()">
            <option value="" disabled selected>Selecione o prédio</option>
            <option *ngFor="let building of buildings" [value]="building.id">{{ building.nome }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <select id="months" name="months" class="form-control custom-select" formControlName="months" required (change)="loadExpenses()">
            <option value="" disabled selected>Selecione o mês</option>
            <option *ngFor="let month of months" [value]="month.monthNumber">{{ month.monthName }}</option>
          </select>
        </div>
        
        <div class="col-md-4">
          <select id="years" name="years" class="form-control custom-select" formControlName="years" required (change)="loadExpenses()">
            <option value="" disabled selected>Selecione o ano</option>
            <option *ngFor="let year of years" [value]="year">{{ year }}</option>
          </select>
        </div>
      </div>
      <!-- Add other form controls within the formGroup -->
    </form>
    
    <!-- Tabela de contas -->
    <div class="table-wrapper">
      <table class="table mt-4">
        <thead>
          <tr>
            <th scope="col">Detalhe</th>
            <th scope="col">Data</th>
            <th scope="col">Valor</th>
            <th scope="col">Tipo</th>
            <th scope="col">Parcela</th>
            <th scope="col">Total de parcelas</th>
            
          </tr>
        </thead>
        <tbody>
          <!-- Aqui você pode iterar sobre os dados das contas e preencher as linhas da tabela -->
          <tr *ngFor="let exepense of commonExepenses">
            <td>{{ exepense.detalhes }}</td>
            <td>{{ formatarData(exepense.data_gasto)}}</td>
            <td>R$ {{ exepense.valor }}</td>
            <td>{{ exepense.tipo }}</td>
            <td>{{ exepense.parcela }}</td>
            <td>{{ exepense.total_parcelas }}</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>

<div *ngIf="addGastosView" style="margin-top: 30px;">
  <div class="container">
    <div class="mb-3">
      <div class="row">
        <div class="col-md-12">
          <div class="file-upload-container">
            <label class="custom-file-upload">
              <input type="file" id="fileInput" class="file-upload-input" (change)="onFileSelected($event)" accept=".csv">
            </label>

            <div class="uploaded-files">
              <ul>
                <li *ngFor="let selectedFile of selectedFiles; let i = index">
                  {{ selectedFile.name }}
                  <button class="file-upload-clear-btn" (click)="deleteFile(i)">X</button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="table-wrapper">
      <table class="table mt-4">
        <thead>
          <tr>
            <th scope="col">Data</th>
            <th scope="col">Detalhe</th>
            <th scope="col">Valor</th>
            <th scope="col">Tipo</th>
            <th scope="col">Parcelar?</th>
            <th scope="col">Adicionar?</th>
          </tr>
        </thead>
        <tbody>
          <!-- Aqui você pode iterar sobre os dados das contas e preencher as linhas da tabela -->
          <tr *ngFor="let contaAdd of contasAdicionar">
            <td>{{ contaAdd.data }}</td>
            <td><input class="custom-input" type="text" [(ngModel)]="contaAdd.detalhe"></td>
            <td class="text-danger">R$ {{ contaAdd.valor*(-1) | number:'1.2-2' }}</td>
            <td>
              <select class="custom-select"  [(ngModel)]="contaAdd.tipo">
                <option>Rateio</option>
                <option>Fundo de Reserva</option>
                <option>Provisão</option>
              </select>
            </td>
            <td>
              <select class="custom-select"  [(ngModel)]="contaAdd.parcelas">
                <option value="1">A vista</option>
                <option value="2">2 X</option>
                <option value="3">3 X</option>
                <option value="4">4 X</option>
                <option value="5">5 X</option>
                <option value="6">6 X</option>
                <option value="7">7 X</option>
                <option value="8">8 X</option>
                <option value="9">9 X</option>
                <option value="10">10 X</option>
                <option value="11">11 X</option>
                <option value="12">12 X</option>
                
              </select>
            </td>
            <td>
              <label class="custom-checkbox">
                <input type="checkbox" [(ngModel)]="contaAdd.adicionar">
                <span class="checkmark"></span>
              </label>
            </td>
            
          </tr>
        </tbody>
      </table>
    </div>
    <div style="text-align: right; margin-right: 50px;">
      <button class="btn btn-primary" (click)="submitGastos()">Inserir</button>
    </div>

  
  </div>
  

</div>
